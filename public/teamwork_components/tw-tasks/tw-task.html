<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="../../bower_components/paper-shadow/paper-shadow.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog-transition.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-action-dialog.html">

<polymer-element name="tw-task" attributes="taskId listId activityId hasDetails hasComments isAssigned hasDueDate hasCategory">
    <template>
        <style>
            :host {
                display: block;
                position: relative;
                padding-left: 12px;
                padding-top: 7px;
                width: 90%;
                font-weight: 300;
            }
            .task-resume {
                background-color: #d6dadc !important;
                color: black;
                padding-top: 10px;
                padding-bottom: 5px;
                padding-left: 5px;
                padding-right: 5px;
            }

            a {
                text-decoration: none;
                color: inherit;
            }

        </style>

        <core-signals on-core-signal-save-task="{{save}}"></core-signals>
        
        <paper-shadow z="1">
            <span role="button" tabindex="0" layout vertical class="task-resume" 
                  on-click="{{openTaskDetail}}">
                <content select=":not(event-form)"></content>  
                <template if="{{additionalsInfo}}">
                    <span horizontal layout end-justified>
                        <template if="{{hasDetails}}">
                            <core-icon icon="description"></core-icon>
                        </template>
                        <template if="{{isAssigned}}">
                            <core-icon icon="assignment-ind"></core-icon>
                        </template>
                        <template if="{{hasComments}}">
                            <core-icon icon="subject"></core-icon>
                        </template>
                        <template if="{{hasCategory}}">
                            <core-icon icon="bookmark"></core-icon>
                        </template>
                        <template if="{{hasDueDate}}">
                            <core-icon icon="alarm-on"></core-icon>
                        </template>
                    </span>
                </template>
            </span>
        </paper-shadow>

        <paper-action-dialog transition="core-transition-bottom" heading="Task details" id="taskDetailDialog" on-epb-click="{{handleFormEvent}}">
            <content select="event-form"></content>
            <event-paper-button dismissive>Cancel</event-paper-button>
            <event-paper-button affirmative autofocus id="add-state-btn" eventName="save-task">Update</event-paper-button>
        </paper-action-dialog>

    </template>
    <script>
        Polymer({
            hasDetails: false,
            hasComments: false,
            isAssigned: false,
            hasDueDate: false,
            hasCategory: false,
            eventDelegates: {
                'epb-click': 'handleFormEvent'
            },
            openTaskDetail: function () {
                console.log("Click on open task detail.");
                this.$.taskDetailDialog.toggle();
            },
            additionalsInfo: function () {
                return this.hasDetails || this.hasComments || this.isAssigned || this.hasDueDate;
            },
            handleFormEvent: function (e, detail, sender) {
                console.log("Handle event 'epb-click'");
                var form = e.currentTarget.querySelector('event-form');
                if (form) {   
                    console.log("Fire event 'event-form-submit'");
                    form.fire('event-form-submit', detail);
                }
            },
            save: function (e, detail, sender) {
                console.log("Handle event 'save-task'");
                if (detail.objectId === this.taskId) {
                    console.log("Completing event information");
                    detail.datas.listId = this.listId;
                    detail.datas.activityId = this.activityId;
                    this.fire('save-task', detail);
                }
            },
        });
    </script>
</polymer-element>
